<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Capsense AI</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.querySelector('form');
      const textarea = document.querySelector('textarea');
      const fileInput = document.querySelector('input[type="file"]');

      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        let customerText = textarea.value.trim();

        if (!customerText && fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const text = await file.text();
          customerText = text.trim();
        }

        if (!customerText) {
          alert('Please paste some feedback or upload a file.');
          return;
        }
      
        try {
          const lines = customerText.split('\n');
          if (lines.length === 1) {
            const response = await fetch('/api/respond', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ customer_text: customerText })
            });
          }  
          else {const response = await fetch('/api/respond_batch', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ customer_texts: customerText })
            });

          }
          if (!response.ok) {
            throw new Error('Server error');
          }

          const result = await response.json();
          console.log('AI Response:', result);
          alert(`AI Response: ${result.ai_response.response_text}`); /*Was raising an error now fixed- I hope*/
        } catch (error) {
          console.error('Error:', error);
          alert('Something went wrong with the index.html. Please try again.');
        }
        
      });
    });
  </script>
  </body>
</html>
